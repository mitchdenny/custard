<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Terminal Snapshot Inspector</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #1a1a2e;
      color: #eee;
      min-height: 100vh;
      padding: 20px;
      display: flex;
      flex-direction: column;
    }
    /* Minimal mode - applied via ?minimal=true query param */
    body.minimal {
      padding: 0;
      background: transparent;
    }
    body.minimal h1,
    body.minimal .info-bar,
    body.minimal .theme-controls {
      display: none !important;
    }
    body.minimal .container {
      height: 100vh;
    }
    body.minimal .svg-container {
      border: none;
      border-radius: 0;
      background: transparent;
      padding: 0;
    }
    body.minimal .svg-container svg {
      box-shadow: 0 0 20px rgba(0, 180, 255, 0.35), 0 0 40px rgba(0, 120, 200, 0.2);
    }
    h1 {
      font-size: 1.5rem;
      margin-bottom: 10px;
      color: #00d4ff;
    }
    .info-bar {
      font-size: 0.85rem;
      color: #888;
      margin-bottom: 20px;
    }
    .container {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      flex: 1;
      min-height: 0;
    }
    .svg-container {
      position: relative;
      border: 2px solid #333;
      border-radius: 8px;
      overflow: hidden;
      background: #0d0d0d;
      flex: 1;
      min-height: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .svg-container svg {
      display: block;
      max-width: 100%;
      max-height: 100%;
      width: auto;
      height: auto;
      image-rendering: pixelated;
    }
    .cell-highlight {
      position: absolute;
      pointer-events: none;
      border: 1px solid #00d4ff;
      border-radius: 2px;
      opacity: 0;
      transition: opacity 0.1s, box-shadow 0.2s;
      box-shadow: 0 0 0 rgba(0, 212, 255, 0);
    }
    .cell-highlight.visible {
      opacity: 1;
    }
    .cell-highlight.shimmer {
      box-shadow: 0 0 12px rgba(0, 212, 255, 0.8), inset 0 0 8px rgba(0, 212, 255, 0.4);
      border-color: #00ffff;
    }
    .tooltip {
      position: fixed;
      background: #2d2d44;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 12px 16px;
      font-size: 13px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.15s;
      z-index: 1000;
      min-width: 280px;
      max-width: 400px;
    }
    .tooltip.visible {
      opacity: 1;
    }
    .tooltip.pinned {
      pointer-events: auto;
      border-color: #00d4ff;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5), 0 0 0 2px rgba(0, 212, 255, 0.3);
    }
    .tooltip-pin-indicator {
      position: absolute;
      top: 8px;
      right: 8px;
      font-size: 12px;
      color: #00d4ff;
      cursor: pointer;
      padding: 4px;
    }
    .tooltip-pin-indicator:hover {
      color: #ff6b6b;
    }
    .highlight-toggle {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      margin-left: 8px;
      background: #3d3d5c;
      border: 1px solid #555;
      border-radius: 4px;
      cursor: pointer;
      font-size: 11px;
      color: #888;
      transition: all 0.2s;
    }
    .highlight-toggle:hover {
      background: #4d4d6c;
      color: #fff;
    }
    .highlight-toggle.active {
      background: #ff6b6b;
      border-color: #ff6b6b;
      color: #fff;
    }
    .tooltip-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid #444;
    }
    .tooltip-char {
      font-family: 'Cascadia Code', 'Fira Code', Consolas, monospace;
      font-size: 28px;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      border: 1px solid #555;
    }
    .tooltip-position {
      color: #888;
      font-size: 12px;
    }
    .tooltip-section {
      margin-bottom: 8px;
    }
    .tooltip-section:last-child {
      margin-bottom: 0;
    }
    .tooltip-label {
      color: #888;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 3px;
    }
    .tooltip-value {
      font-family: 'Cascadia Code', 'Fira Code', Consolas, monospace;
      font-size: 12px;
    }
    .tooltip-row {
      display: flex;
      gap: 16px;
    }
    .tooltip-row > div {
      flex: 1;
    }
    .color-swatch {
      display: inline-block;
      width: 14px;
      height: 14px;
      border-radius: 3px;
      border: 1px solid #666;
      vertical-align: middle;
      margin-right: 6px;
    }
    .attr-badge {
      display: inline-block;
      padding: 2px 6px;
      margin: 2px;
      border-radius: 4px;
      font-size: 11px;
      background: #3d3d5c;
    }
    .attr-badge.bold { font-weight: bold; }
    .attr-badge.italic { font-style: italic; }
    .attr-badge.underline { text-decoration: underline; }
    .attr-badge.strikethrough { text-decoration: line-through; }
    .attr-badge.dim { opacity: 0.5; }
    .attr-badge.blink { background: #5c5c3d; }
    .attr-badge.reverse { background: #5c3d5c; }
    .attr-badge.hidden { background: #3d3d3d; }
    .attr-badge.overline { text-decoration: overline; }
    .theme-controls {
      display: flex;
      gap: 20px;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .theme-presets {
      display: flex;
      gap: 8px;
    }
    .theme-btn {
      padding: 8px 16px;
      border: 1px solid #444;
      border-radius: 6px;
      background: #2d2d44;
      color: #eee;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
    }
    .theme-btn:hover {
      background: #3d3d5c;
    }
    .theme-btn.active {
      background: #00d4ff;
      color: #000;
      border-color: #00d4ff;
    }
    .color-pickers {
      display: flex;
      gap: 16px;
      align-items: center;
    }
    .color-pickers label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: #888;
    }
    .color-pickers input[type="color"] {
      width: 40px;
      height: 28px;
      border: 1px solid #444;
      border-radius: 4px;
      cursor: pointer;
      background: transparent;
    }
    .grid-controls {
      display: flex;
      gap: 16px;
      align-items: center;
    }
    .grid-controls label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      color: #888;
      cursor: pointer;
    }
    .grid-controls input[type="checkbox"] {
      width: 16px;
      height: 16px;
      cursor: pointer;
    }
    .svg-container .cell-grid { display: none; }
    .svg-container.show-cell-grid .cell-grid { display: block; }
    .svg-container .pixel-grid { display: none; }
    .svg-container.show-pixel-grid .pixel-grid { display: block; }
  </style>
</head>
<body>
  <h1>Terminal Snapshot Inspector</h1>
  <div class="info-bar">Size: 50 × 3 cells | Hover over cells to inspect</div>
  <div class="theme-controls">
    <div class="theme-presets">
      <button id="btn-dark" class="theme-btn active">Dark Mode</button>
      <button id="btn-light" class="theme-btn">Light Mode</button>
    </div>
    <div class="color-pickers">
      <label>Background: <input type="color" id="bg-picker" value="#1e1e1e"></label>
      <label>Foreground: <input type="color" id="fg-picker" value="#d4d4d4"></label>
    </div>
    <div class="grid-controls">
      <label><input type="checkbox" id="cell-grid-toggle"> Cell Grid</label>
      <label><input type="color" id="cell-grid-color" value="#808080"></label>
      <label><input type="checkbox" id="pixel-grid-toggle"> Pixel Grid</label>
      <label><input type="color" id="pixel-grid-color" value="#404040"></label>
    </div>
  </div>
  <div class="container">
    <div class="svg-container" id="svg-container">
<svg xmlns="http://www.w3.org/2000/svg" width="450" height="54" viewBox="0 0 450 54">
  <defs>
    <style>
      .terminal-text { font-family: 'Cascadia Code', 'Fira Code', 'JetBrains Mono', Consolas, monospace; font-size: 14px; }
      .cursor { fill: #ffffff; opacity: 0.7; }
      @keyframes blink { 0%, 49% { opacity: 1; } 50%, 100% { opacity: 0.3; } }
      .blink { animation: blink 1s infinite; }
      .cell-grid { stroke: rgba(128, 128, 128, 0.5); stroke-width: 0.5; vector-effect: non-scaling-stroke; }
      .pixel-grid { stroke: rgba(64, 64, 64, 0.3); stroke-width: 0.25; vector-effect: non-scaling-stroke; }
      /* Cell group highlighting for related cells (hyperlinks, etc.) */
      .cell { pointer-events: bounding-box; }
      .cell.highlight > rect.cell-bg { stroke: #ff6b6b; stroke-width: 2; }
      .cell.highlight > text { fill: #ff6b6b !important; }
    </style>
  </defs>
  <rect width="450" height="54" fill="#0f0f1a"/>
  <g class="terminal-text">
    <g class="cell" data-x="24" data-y="1">
      <rect class="cell-bg" x="216" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="46" data-y="1">
      <rect class="cell-bg" x="414" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="47" data-y="1">
      <rect class="cell-bg" x="423" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="48" data-y="1">
      <rect class="cell-bg" x="432" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="49" data-y="1">
      <rect class="cell-bg" x="441" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="0" data-y="2">
      <rect class="cell-bg" x="0" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="1" data-y="2">
      <rect class="cell-bg" x="9" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="45" data-y="1">
      <rect class="cell-bg" x="405" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="2" data-y="2">
      <rect class="cell-bg" x="18" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="4" data-y="2">
      <rect class="cell-bg" x="36" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="5" data-y="2">
      <rect class="cell-bg" x="45" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="6" data-y="2">
      <rect class="cell-bg" x="54" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="7" data-y="2">
      <rect class="cell-bg" x="63" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="8" data-y="2">
      <rect class="cell-bg" x="72" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="9" data-y="2">
      <rect class="cell-bg" x="81" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="3" data-y="2">
      <rect class="cell-bg" x="27" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="44" data-y="1">
      <rect class="cell-bg" x="396" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="43" data-y="1">
      <rect class="cell-bg" x="387" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="42" data-y="1">
      <rect class="cell-bg" x="378" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="27" data-y="1">
      <rect class="cell-bg" x="243" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="28" data-y="1">
      <rect class="cell-bg" x="252" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="29" data-y="1">
      <rect class="cell-bg" x="261" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="30" data-y="1">
      <rect class="cell-bg" x="270" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="31" data-y="1">
      <rect class="cell-bg" x="279" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="32" data-y="1">
      <rect class="cell-bg" x="288" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="33" data-y="1">
      <rect class="cell-bg" x="297" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="34" data-y="1">
      <rect class="cell-bg" x="306" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="35" data-y="1">
      <rect class="cell-bg" x="315" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="36" data-y="1">
      <rect class="cell-bg" x="324" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="37" data-y="1">
      <rect class="cell-bg" x="333" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="38" data-y="1">
      <rect class="cell-bg" x="342" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="39" data-y="1">
      <rect class="cell-bg" x="351" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="40" data-y="1">
      <rect class="cell-bg" x="360" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="41" data-y="1">
      <rect class="cell-bg" x="369" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="10" data-y="2">
      <rect class="cell-bg" x="90" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="11" data-y="2">
      <rect class="cell-bg" x="99" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="12" data-y="2">
      <rect class="cell-bg" x="108" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="13" data-y="2">
      <rect class="cell-bg" x="117" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="33" data-y="2">
      <rect class="cell-bg" x="297" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="34" data-y="2">
      <rect class="cell-bg" x="306" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="35" data-y="2">
      <rect class="cell-bg" x="315" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="36" data-y="2">
      <rect class="cell-bg" x="324" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="37" data-y="2">
      <rect class="cell-bg" x="333" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="38" data-y="2">
      <rect class="cell-bg" x="342" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="39" data-y="2">
      <rect class="cell-bg" x="351" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="40" data-y="2">
      <rect class="cell-bg" x="360" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="41" data-y="2">
      <rect class="cell-bg" x="369" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="42" data-y="2">
      <rect class="cell-bg" x="378" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="43" data-y="2">
      <rect class="cell-bg" x="387" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="44" data-y="2">
      <rect class="cell-bg" x="396" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="45" data-y="2">
      <rect class="cell-bg" x="405" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="46" data-y="2">
      <rect class="cell-bg" x="414" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="47" data-y="2">
      <rect class="cell-bg" x="423" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="32" data-y="2">
      <rect class="cell-bg" x="288" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="26" data-y="1">
      <rect class="cell-bg" x="234" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="31" data-y="2">
      <rect class="cell-bg" x="279" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="29" data-y="2">
      <rect class="cell-bg" x="261" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="14" data-y="2">
      <rect class="cell-bg" x="126" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="15" data-y="2">
      <rect class="cell-bg" x="135" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="16" data-y="2">
      <rect class="cell-bg" x="144" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="17" data-y="2">
      <rect class="cell-bg" x="153" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="18" data-y="2">
      <rect class="cell-bg" x="162" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="19" data-y="2">
      <rect class="cell-bg" x="171" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="20" data-y="2">
      <rect class="cell-bg" x="180" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="21" data-y="2">
      <rect class="cell-bg" x="189" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="22" data-y="2">
      <rect class="cell-bg" x="198" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="23" data-y="2">
      <rect class="cell-bg" x="207" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="24" data-y="2">
      <rect class="cell-bg" x="216" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="25" data-y="2">
      <rect class="cell-bg" x="225" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="26" data-y="2">
      <rect class="cell-bg" x="234" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="27" data-y="2">
      <rect class="cell-bg" x="243" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="28" data-y="2">
      <rect class="cell-bg" x="252" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="30" data-y="2">
      <rect class="cell-bg" x="270" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="25" data-y="1">
      <rect class="cell-bg" x="225" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="49" data-y="2">
      <rect class="cell-bg" x="441" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="23" data-y="1">
      <rect class="cell-bg" x="207" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="41" data-y="0">
      <rect class="cell-bg" x="369" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="40" data-y="0">
      <rect class="cell-bg" x="360" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="39" data-y="0">
      <rect class="cell-bg" x="351" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="38" data-y="0">
      <rect class="cell-bg" x="342" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="37" data-y="0">
      <rect class="cell-bg" x="333" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="48" data-y="2">
      <rect class="cell-bg" x="432" y="36" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="35" data-y="0">
      <rect class="cell-bg" x="315" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="34" data-y="0">
      <rect class="cell-bg" x="306" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="33" data-y="0">
      <rect class="cell-bg" x="297" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="32" data-y="0">
      <rect class="cell-bg" x="288" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="31" data-y="0">
      <rect class="cell-bg" x="279" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="30" data-y="0">
      <rect class="cell-bg" x="270" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="29" data-y="0">
      <rect class="cell-bg" x="261" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="28" data-y="0">
      <rect class="cell-bg" x="252" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="27" data-y="0">
      <rect class="cell-bg" x="243" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="26" data-y="0">
      <rect class="cell-bg" x="234" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="25" data-y="0">
      <rect class="cell-bg" x="225" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="24" data-y="0">
      <rect class="cell-bg" x="216" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="23" data-y="0">
      <rect class="cell-bg" x="207" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="22" data-y="0">
      <rect class="cell-bg" x="198" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="21" data-y="0">
      <rect class="cell-bg" x="189" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="20" data-y="0">
      <rect class="cell-bg" x="180" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="19" data-y="0">
      <rect class="cell-bg" x="171" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="18" data-y="0">
      <rect class="cell-bg" x="162" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="17" data-y="0">
      <rect class="cell-bg" x="153" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="16" data-y="0">
      <rect class="cell-bg" x="144" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="15" data-y="0">
      <rect class="cell-bg" x="135" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="42" data-y="0">
      <rect class="cell-bg" x="378" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="43" data-y="0">
      <rect class="cell-bg" x="387" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="36" data-y="0">
      <rect class="cell-bg" x="324" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="45" data-y="0">
      <rect class="cell-bg" x="405" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="22" data-y="1">
      <rect class="cell-bg" x="198" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="21" data-y="1">
      <rect class="cell-bg" x="189" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="20" data-y="1">
      <rect class="cell-bg" x="180" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="19" data-y="1">
      <rect class="cell-bg" x="171" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="18" data-y="1">
      <rect class="cell-bg" x="162" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="17" data-y="1">
      <rect class="cell-bg" x="153" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="44" data-y="0">
      <rect class="cell-bg" x="396" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="15" data-y="1">
      <rect class="cell-bg" x="135" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="14" data-y="1">
      <rect class="cell-bg" x="126" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="13" data-y="1">
      <rect class="cell-bg" x="117" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="12" data-y="1">
      <rect class="cell-bg" x="108" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="11" data-y="1">
      <rect class="cell-bg" x="99" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="10" data-y="1">
      <rect class="cell-bg" x="90" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="16" data-y="1">
      <rect class="cell-bg" x="144" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="8" data-y="1">
      <rect class="cell-bg" x="72" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="7" data-y="1">
      <rect class="cell-bg" x="63" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="6" data-y="1">
      <rect class="cell-bg" x="54" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="5" data-y="1">
      <rect class="cell-bg" x="45" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="4" data-y="1">
      <rect class="cell-bg" x="36" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="3" data-y="1">
      <rect class="cell-bg" x="27" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="2" data-y="1">
      <rect class="cell-bg" x="18" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="1" data-y="1">
      <rect class="cell-bg" x="9" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="0" data-y="1">
      <rect class="cell-bg" x="0" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="49" data-y="0">
      <rect class="cell-bg" x="441" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="48" data-y="0">
      <rect class="cell-bg" x="432" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="47" data-y="0">
      <rect class="cell-bg" x="423" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="46" data-y="0">
      <rect class="cell-bg" x="414" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="9" data-y="1">
      <rect class="cell-bg" x="81" y="18" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="1" data-y="0">
    </g>
    <g class="cell" data-x="0" data-y="0">
      <rect class="cell-bg" x="0" y="0" width="18" height="18" fill="#0f0f1a"/>
      <text x="0.0" y="13.5" fill="#e0e0e0" text-anchor="start">日</text>
    </g>
    <g class="cell" data-x="3" data-y="0">
    </g>
    <g class="cell" data-x="2" data-y="0">
      <rect class="cell-bg" x="18" y="0" width="18" height="18" fill="#0f0f1a"/>
      <text x="18.0" y="13.5" fill="#e0e0e0" text-anchor="start">本</text>
    </g>
    <g class="cell" data-x="5" data-y="0">
    </g>
    <g class="cell" data-x="4" data-y="0">
      <rect class="cell-bg" x="36" y="0" width="18" height="18" fill="#0f0f1a"/>
      <text x="36.0" y="13.5" fill="#e0e0e0" text-anchor="start">語</text>
    </g>
    <g class="cell" data-x="7" data-y="0">
    </g>
    <g class="cell" data-x="6" data-y="0">
      <rect class="cell-bg" x="54" y="0" width="18" height="18" fill="#0f0f1a"/>
      <text x="54.0" y="13.5" fill="#e0e0e0" text-anchor="start">テ</text>
    </g>
    <g class="cell" data-x="9" data-y="0">
    </g>
    <g class="cell" data-x="8" data-y="0">
      <rect class="cell-bg" x="72" y="0" width="18" height="18" fill="#0f0f1a"/>
      <text x="72.0" y="13.5" fill="#e0e0e0" text-anchor="start">ス</text>
    </g>
    <g class="cell" data-x="11" data-y="0">
    </g>
    <g class="cell" data-x="10" data-y="0">
      <rect class="cell-bg" x="90" y="0" width="18" height="18" fill="#0f0f1a"/>
      <text x="90.0" y="13.5" fill="#e0e0e0" text-anchor="start">ト</text>
    </g>
    <g class="cell" data-x="12" data-y="0">
      <rect class="cell-bg" x="108" y="0" width="9" height="18" fill="#0f0f1a"/>
    </g>
    <g class="cell" data-x="14" data-y="0">
    </g>
    <g class="cell" data-x="13" data-y="0">
      <rect class="cell-bg" x="117" y="0" width="18" height="18" fill="#0f0f1a"/>
      <text x="117.0" y="13.5" fill="#e0e0e0" text-anchor="start">&#127881;</text>
    </g>
  </g>
  <rect class="cursor" x="135" y="0" width="9" height="18"/>
  <g class="pixel-grid">
    <line x1="1" y1="0" x2="1" y2="54"/>
    <line x1="2" y1="0" x2="2" y2="54"/>
    <line x1="3" y1="0" x2="3" y2="54"/>
    <line x1="4" y1="0" x2="4" y2="54"/>
    <line x1="5" y1="0" x2="5" y2="54"/>
    <line x1="6" y1="0" x2="6" y2="54"/>
    <line x1="7" y1="0" x2="7" y2="54"/>
    <line x1="8" y1="0" x2="8" y2="54"/>
    <line x1="9" y1="0" x2="9" y2="54"/>
    <line x1="10" y1="0" x2="10" y2="54"/>
    <line x1="11" y1="0" x2="11" y2="54"/>
    <line x1="12" y1="0" x2="12" y2="54"/>
    <line x1="13" y1="0" x2="13" y2="54"/>
    <line x1="14" y1="0" x2="14" y2="54"/>
    <line x1="15" y1="0" x2="15" y2="54"/>
    <line x1="16" y1="0" x2="16" y2="54"/>
    <line x1="17" y1="0" x2="17" y2="54"/>
    <line x1="18" y1="0" x2="18" y2="54"/>
    <line x1="19" y1="0" x2="19" y2="54"/>
    <line x1="20" y1="0" x2="20" y2="54"/>
    <line x1="21" y1="0" x2="21" y2="54"/>
    <line x1="22" y1="0" x2="22" y2="54"/>
    <line x1="23" y1="0" x2="23" y2="54"/>
    <line x1="24" y1="0" x2="24" y2="54"/>
    <line x1="25" y1="0" x2="25" y2="54"/>
    <line x1="26" y1="0" x2="26" y2="54"/>
    <line x1="27" y1="0" x2="27" y2="54"/>
    <line x1="28" y1="0" x2="28" y2="54"/>
    <line x1="29" y1="0" x2="29" y2="54"/>
    <line x1="30" y1="0" x2="30" y2="54"/>
    <line x1="31" y1="0" x2="31" y2="54"/>
    <line x1="32" y1="0" x2="32" y2="54"/>
    <line x1="33" y1="0" x2="33" y2="54"/>
    <line x1="34" y1="0" x2="34" y2="54"/>
    <line x1="35" y1="0" x2="35" y2="54"/>
    <line x1="36" y1="0" x2="36" y2="54"/>
    <line x1="37" y1="0" x2="37" y2="54"/>
    <line x1="38" y1="0" x2="38" y2="54"/>
    <line x1="39" y1="0" x2="39" y2="54"/>
    <line x1="40" y1="0" x2="40" y2="54"/>
    <line x1="41" y1="0" x2="41" y2="54"/>
    <line x1="42" y1="0" x2="42" y2="54"/>
    <line x1="43" y1="0" x2="43" y2="54"/>
    <line x1="44" y1="0" x2="44" y2="54"/>
    <line x1="45" y1="0" x2="45" y2="54"/>
    <line x1="46" y1="0" x2="46" y2="54"/>
    <line x1="47" y1="0" x2="47" y2="54"/>
    <line x1="48" y1="0" x2="48" y2="54"/>
    <line x1="49" y1="0" x2="49" y2="54"/>
    <line x1="50" y1="0" x2="50" y2="54"/>
    <line x1="51" y1="0" x2="51" y2="54"/>
    <line x1="52" y1="0" x2="52" y2="54"/>
    <line x1="53" y1="0" x2="53" y2="54"/>
    <line x1="54" y1="0" x2="54" y2="54"/>
    <line x1="55" y1="0" x2="55" y2="54"/>
    <line x1="56" y1="0" x2="56" y2="54"/>
    <line x1="57" y1="0" x2="57" y2="54"/>
    <line x1="58" y1="0" x2="58" y2="54"/>
    <line x1="59" y1="0" x2="59" y2="54"/>
    <line x1="60" y1="0" x2="60" y2="54"/>
    <line x1="61" y1="0" x2="61" y2="54"/>
    <line x1="62" y1="0" x2="62" y2="54"/>
    <line x1="63" y1="0" x2="63" y2="54"/>
    <line x1="64" y1="0" x2="64" y2="54"/>
    <line x1="65" y1="0" x2="65" y2="54"/>
    <line x1="66" y1="0" x2="66" y2="54"/>
    <line x1="67" y1="0" x2="67" y2="54"/>
    <line x1="68" y1="0" x2="68" y2="54"/>
    <line x1="69" y1="0" x2="69" y2="54"/>
    <line x1="70" y1="0" x2="70" y2="54"/>
    <line x1="71" y1="0" x2="71" y2="54"/>
    <line x1="72" y1="0" x2="72" y2="54"/>
    <line x1="73" y1="0" x2="73" y2="54"/>
    <line x1="74" y1="0" x2="74" y2="54"/>
    <line x1="75" y1="0" x2="75" y2="54"/>
    <line x1="76" y1="0" x2="76" y2="54"/>
    <line x1="77" y1="0" x2="77" y2="54"/>
    <line x1="78" y1="0" x2="78" y2="54"/>
    <line x1="79" y1="0" x2="79" y2="54"/>
    <line x1="80" y1="0" x2="80" y2="54"/>
    <line x1="81" y1="0" x2="81" y2="54"/>
    <line x1="82" y1="0" x2="82" y2="54"/>
    <line x1="83" y1="0" x2="83" y2="54"/>
    <line x1="84" y1="0" x2="84" y2="54"/>
    <line x1="85" y1="0" x2="85" y2="54"/>
    <line x1="86" y1="0" x2="86" y2="54"/>
    <line x1="87" y1="0" x2="87" y2="54"/>
    <line x1="88" y1="0" x2="88" y2="54"/>
    <line x1="89" y1="0" x2="89" y2="54"/>
    <line x1="90" y1="0" x2="90" y2="54"/>
    <line x1="91" y1="0" x2="91" y2="54"/>
    <line x1="92" y1="0" x2="92" y2="54"/>
    <line x1="93" y1="0" x2="93" y2="54"/>
    <line x1="94" y1="0" x2="94" y2="54"/>
    <line x1="95" y1="0" x2="95" y2="54"/>
    <line x1="96" y1="0" x2="96" y2="54"/>
    <line x1="97" y1="0" x2="97" y2="54"/>
    <line x1="98" y1="0" x2="98" y2="54"/>
    <line x1="99" y1="0" x2="99" y2="54"/>
    <line x1="100" y1="0" x2="100" y2="54"/>
    <line x1="101" y1="0" x2="101" y2="54"/>
    <line x1="102" y1="0" x2="102" y2="54"/>
    <line x1="103" y1="0" x2="103" y2="54"/>
    <line x1="104" y1="0" x2="104" y2="54"/>
    <line x1="105" y1="0" x2="105" y2="54"/>
    <line x1="106" y1="0" x2="106" y2="54"/>
    <line x1="107" y1="0" x2="107" y2="54"/>
    <line x1="108" y1="0" x2="108" y2="54"/>
    <line x1="109" y1="0" x2="109" y2="54"/>
    <line x1="110" y1="0" x2="110" y2="54"/>
    <line x1="111" y1="0" x2="111" y2="54"/>
    <line x1="112" y1="0" x2="112" y2="54"/>
    <line x1="113" y1="0" x2="113" y2="54"/>
    <line x1="114" y1="0" x2="114" y2="54"/>
    <line x1="115" y1="0" x2="115" y2="54"/>
    <line x1="116" y1="0" x2="116" y2="54"/>
    <line x1="117" y1="0" x2="117" y2="54"/>
    <line x1="118" y1="0" x2="118" y2="54"/>
    <line x1="119" y1="0" x2="119" y2="54"/>
    <line x1="120" y1="0" x2="120" y2="54"/>
    <line x1="121" y1="0" x2="121" y2="54"/>
    <line x1="122" y1="0" x2="122" y2="54"/>
    <line x1="123" y1="0" x2="123" y2="54"/>
    <line x1="124" y1="0" x2="124" y2="54"/>
    <line x1="125" y1="0" x2="125" y2="54"/>
    <line x1="126" y1="0" x2="126" y2="54"/>
    <line x1="127" y1="0" x2="127" y2="54"/>
    <line x1="128" y1="0" x2="128" y2="54"/>
    <line x1="129" y1="0" x2="129" y2="54"/>
    <line x1="130" y1="0" x2="130" y2="54"/>
    <line x1="131" y1="0" x2="131" y2="54"/>
    <line x1="132" y1="0" x2="132" y2="54"/>
    <line x1="133" y1="0" x2="133" y2="54"/>
    <line x1="134" y1="0" x2="134" y2="54"/>
    <line x1="135" y1="0" x2="135" y2="54"/>
    <line x1="136" y1="0" x2="136" y2="54"/>
    <line x1="137" y1="0" x2="137" y2="54"/>
    <line x1="138" y1="0" x2="138" y2="54"/>
    <line x1="139" y1="0" x2="139" y2="54"/>
    <line x1="140" y1="0" x2="140" y2="54"/>
    <line x1="141" y1="0" x2="141" y2="54"/>
    <line x1="142" y1="0" x2="142" y2="54"/>
    <line x1="143" y1="0" x2="143" y2="54"/>
    <line x1="144" y1="0" x2="144" y2="54"/>
    <line x1="145" y1="0" x2="145" y2="54"/>
    <line x1="146" y1="0" x2="146" y2="54"/>
    <line x1="147" y1="0" x2="147" y2="54"/>
    <line x1="148" y1="0" x2="148" y2="54"/>
    <line x1="149" y1="0" x2="149" y2="54"/>
    <line x1="150" y1="0" x2="150" y2="54"/>
    <line x1="151" y1="0" x2="151" y2="54"/>
    <line x1="152" y1="0" x2="152" y2="54"/>
    <line x1="153" y1="0" x2="153" y2="54"/>
    <line x1="154" y1="0" x2="154" y2="54"/>
    <line x1="155" y1="0" x2="155" y2="54"/>
    <line x1="156" y1="0" x2="156" y2="54"/>
    <line x1="157" y1="0" x2="157" y2="54"/>
    <line x1="158" y1="0" x2="158" y2="54"/>
    <line x1="159" y1="0" x2="159" y2="54"/>
    <line x1="160" y1="0" x2="160" y2="54"/>
    <line x1="161" y1="0" x2="161" y2="54"/>
    <line x1="162" y1="0" x2="162" y2="54"/>
    <line x1="163" y1="0" x2="163" y2="54"/>
    <line x1="164" y1="0" x2="164" y2="54"/>
    <line x1="165" y1="0" x2="165" y2="54"/>
    <line x1="166" y1="0" x2="166" y2="54"/>
    <line x1="167" y1="0" x2="167" y2="54"/>
    <line x1="168" y1="0" x2="168" y2="54"/>
    <line x1="169" y1="0" x2="169" y2="54"/>
    <line x1="170" y1="0" x2="170" y2="54"/>
    <line x1="171" y1="0" x2="171" y2="54"/>
    <line x1="172" y1="0" x2="172" y2="54"/>
    <line x1="173" y1="0" x2="173" y2="54"/>
    <line x1="174" y1="0" x2="174" y2="54"/>
    <line x1="175" y1="0" x2="175" y2="54"/>
    <line x1="176" y1="0" x2="176" y2="54"/>
    <line x1="177" y1="0" x2="177" y2="54"/>
    <line x1="178" y1="0" x2="178" y2="54"/>
    <line x1="179" y1="0" x2="179" y2="54"/>
    <line x1="180" y1="0" x2="180" y2="54"/>
    <line x1="181" y1="0" x2="181" y2="54"/>
    <line x1="182" y1="0" x2="182" y2="54"/>
    <line x1="183" y1="0" x2="183" y2="54"/>
    <line x1="184" y1="0" x2="184" y2="54"/>
    <line x1="185" y1="0" x2="185" y2="54"/>
    <line x1="186" y1="0" x2="186" y2="54"/>
    <line x1="187" y1="0" x2="187" y2="54"/>
    <line x1="188" y1="0" x2="188" y2="54"/>
    <line x1="189" y1="0" x2="189" y2="54"/>
    <line x1="190" y1="0" x2="190" y2="54"/>
    <line x1="191" y1="0" x2="191" y2="54"/>
    <line x1="192" y1="0" x2="192" y2="54"/>
    <line x1="193" y1="0" x2="193" y2="54"/>
    <line x1="194" y1="0" x2="194" y2="54"/>
    <line x1="195" y1="0" x2="195" y2="54"/>
    <line x1="196" y1="0" x2="196" y2="54"/>
    <line x1="197" y1="0" x2="197" y2="54"/>
    <line x1="198" y1="0" x2="198" y2="54"/>
    <line x1="199" y1="0" x2="199" y2="54"/>
    <line x1="200" y1="0" x2="200" y2="54"/>
    <line x1="201" y1="0" x2="201" y2="54"/>
    <line x1="202" y1="0" x2="202" y2="54"/>
    <line x1="203" y1="0" x2="203" y2="54"/>
    <line x1="204" y1="0" x2="204" y2="54"/>
    <line x1="205" y1="0" x2="205" y2="54"/>
    <line x1="206" y1="0" x2="206" y2="54"/>
    <line x1="207" y1="0" x2="207" y2="54"/>
    <line x1="208" y1="0" x2="208" y2="54"/>
    <line x1="209" y1="0" x2="209" y2="54"/>
    <line x1="210" y1="0" x2="210" y2="54"/>
    <line x1="211" y1="0" x2="211" y2="54"/>
    <line x1="212" y1="0" x2="212" y2="54"/>
    <line x1="213" y1="0" x2="213" y2="54"/>
    <line x1="214" y1="0" x2="214" y2="54"/>
    <line x1="215" y1="0" x2="215" y2="54"/>
    <line x1="216" y1="0" x2="216" y2="54"/>
    <line x1="217" y1="0" x2="217" y2="54"/>
    <line x1="218" y1="0" x2="218" y2="54"/>
    <line x1="219" y1="0" x2="219" y2="54"/>
    <line x1="220" y1="0" x2="220" y2="54"/>
    <line x1="221" y1="0" x2="221" y2="54"/>
    <line x1="222" y1="0" x2="222" y2="54"/>
    <line x1="223" y1="0" x2="223" y2="54"/>
    <line x1="224" y1="0" x2="224" y2="54"/>
    <line x1="225" y1="0" x2="225" y2="54"/>
    <line x1="226" y1="0" x2="226" y2="54"/>
    <line x1="227" y1="0" x2="227" y2="54"/>
    <line x1="228" y1="0" x2="228" y2="54"/>
    <line x1="229" y1="0" x2="229" y2="54"/>
    <line x1="230" y1="0" x2="230" y2="54"/>
    <line x1="231" y1="0" x2="231" y2="54"/>
    <line x1="232" y1="0" x2="232" y2="54"/>
    <line x1="233" y1="0" x2="233" y2="54"/>
    <line x1="234" y1="0" x2="234" y2="54"/>
    <line x1="235" y1="0" x2="235" y2="54"/>
    <line x1="236" y1="0" x2="236" y2="54"/>
    <line x1="237" y1="0" x2="237" y2="54"/>
    <line x1="238" y1="0" x2="238" y2="54"/>
    <line x1="239" y1="0" x2="239" y2="54"/>
    <line x1="240" y1="0" x2="240" y2="54"/>
    <line x1="241" y1="0" x2="241" y2="54"/>
    <line x1="242" y1="0" x2="242" y2="54"/>
    <line x1="243" y1="0" x2="243" y2="54"/>
    <line x1="244" y1="0" x2="244" y2="54"/>
    <line x1="245" y1="0" x2="245" y2="54"/>
    <line x1="246" y1="0" x2="246" y2="54"/>
    <line x1="247" y1="0" x2="247" y2="54"/>
    <line x1="248" y1="0" x2="248" y2="54"/>
    <line x1="249" y1="0" x2="249" y2="54"/>
    <line x1="250" y1="0" x2="250" y2="54"/>
    <line x1="251" y1="0" x2="251" y2="54"/>
    <line x1="252" y1="0" x2="252" y2="54"/>
    <line x1="253" y1="0" x2="253" y2="54"/>
    <line x1="254" y1="0" x2="254" y2="54"/>
    <line x1="255" y1="0" x2="255" y2="54"/>
    <line x1="256" y1="0" x2="256" y2="54"/>
    <line x1="257" y1="0" x2="257" y2="54"/>
    <line x1="258" y1="0" x2="258" y2="54"/>
    <line x1="259" y1="0" x2="259" y2="54"/>
    <line x1="260" y1="0" x2="260" y2="54"/>
    <line x1="261" y1="0" x2="261" y2="54"/>
    <line x1="262" y1="0" x2="262" y2="54"/>
    <line x1="263" y1="0" x2="263" y2="54"/>
    <line x1="264" y1="0" x2="264" y2="54"/>
    <line x1="265" y1="0" x2="265" y2="54"/>
    <line x1="266" y1="0" x2="266" y2="54"/>
    <line x1="267" y1="0" x2="267" y2="54"/>
    <line x1="268" y1="0" x2="268" y2="54"/>
    <line x1="269" y1="0" x2="269" y2="54"/>
    <line x1="270" y1="0" x2="270" y2="54"/>
    <line x1="271" y1="0" x2="271" y2="54"/>
    <line x1="272" y1="0" x2="272" y2="54"/>
    <line x1="273" y1="0" x2="273" y2="54"/>
    <line x1="274" y1="0" x2="274" y2="54"/>
    <line x1="275" y1="0" x2="275" y2="54"/>
    <line x1="276" y1="0" x2="276" y2="54"/>
    <line x1="277" y1="0" x2="277" y2="54"/>
    <line x1="278" y1="0" x2="278" y2="54"/>
    <line x1="279" y1="0" x2="279" y2="54"/>
    <line x1="280" y1="0" x2="280" y2="54"/>
    <line x1="281" y1="0" x2="281" y2="54"/>
    <line x1="282" y1="0" x2="282" y2="54"/>
    <line x1="283" y1="0" x2="283" y2="54"/>
    <line x1="284" y1="0" x2="284" y2="54"/>
    <line x1="285" y1="0" x2="285" y2="54"/>
    <line x1="286" y1="0" x2="286" y2="54"/>
    <line x1="287" y1="0" x2="287" y2="54"/>
    <line x1="288" y1="0" x2="288" y2="54"/>
    <line x1="289" y1="0" x2="289" y2="54"/>
    <line x1="290" y1="0" x2="290" y2="54"/>
    <line x1="291" y1="0" x2="291" y2="54"/>
    <line x1="292" y1="0" x2="292" y2="54"/>
    <line x1="293" y1="0" x2="293" y2="54"/>
    <line x1="294" y1="0" x2="294" y2="54"/>
    <line x1="295" y1="0" x2="295" y2="54"/>
    <line x1="296" y1="0" x2="296" y2="54"/>
    <line x1="297" y1="0" x2="297" y2="54"/>
    <line x1="298" y1="0" x2="298" y2="54"/>
    <line x1="299" y1="0" x2="299" y2="54"/>
    <line x1="300" y1="0" x2="300" y2="54"/>
    <line x1="301" y1="0" x2="301" y2="54"/>
    <line x1="302" y1="0" x2="302" y2="54"/>
    <line x1="303" y1="0" x2="303" y2="54"/>
    <line x1="304" y1="0" x2="304" y2="54"/>
    <line x1="305" y1="0" x2="305" y2="54"/>
    <line x1="306" y1="0" x2="306" y2="54"/>
    <line x1="307" y1="0" x2="307" y2="54"/>
    <line x1="308" y1="0" x2="308" y2="54"/>
    <line x1="309" y1="0" x2="309" y2="54"/>
    <line x1="310" y1="0" x2="310" y2="54"/>
    <line x1="311" y1="0" x2="311" y2="54"/>
    <line x1="312" y1="0" x2="312" y2="54"/>
    <line x1="313" y1="0" x2="313" y2="54"/>
    <line x1="314" y1="0" x2="314" y2="54"/>
    <line x1="315" y1="0" x2="315" y2="54"/>
    <line x1="316" y1="0" x2="316" y2="54"/>
    <line x1="317" y1="0" x2="317" y2="54"/>
    <line x1="318" y1="0" x2="318" y2="54"/>
    <line x1="319" y1="0" x2="319" y2="54"/>
    <line x1="320" y1="0" x2="320" y2="54"/>
    <line x1="321" y1="0" x2="321" y2="54"/>
    <line x1="322" y1="0" x2="322" y2="54"/>
    <line x1="323" y1="0" x2="323" y2="54"/>
    <line x1="324" y1="0" x2="324" y2="54"/>
    <line x1="325" y1="0" x2="325" y2="54"/>
    <line x1="326" y1="0" x2="326" y2="54"/>
    <line x1="327" y1="0" x2="327" y2="54"/>
    <line x1="328" y1="0" x2="328" y2="54"/>
    <line x1="329" y1="0" x2="329" y2="54"/>
    <line x1="330" y1="0" x2="330" y2="54"/>
    <line x1="331" y1="0" x2="331" y2="54"/>
    <line x1="332" y1="0" x2="332" y2="54"/>
    <line x1="333" y1="0" x2="333" y2="54"/>
    <line x1="334" y1="0" x2="334" y2="54"/>
    <line x1="335" y1="0" x2="335" y2="54"/>
    <line x1="336" y1="0" x2="336" y2="54"/>
    <line x1="337" y1="0" x2="337" y2="54"/>
    <line x1="338" y1="0" x2="338" y2="54"/>
    <line x1="339" y1="0" x2="339" y2="54"/>
    <line x1="340" y1="0" x2="340" y2="54"/>
    <line x1="341" y1="0" x2="341" y2="54"/>
    <line x1="342" y1="0" x2="342" y2="54"/>
    <line x1="343" y1="0" x2="343" y2="54"/>
    <line x1="344" y1="0" x2="344" y2="54"/>
    <line x1="345" y1="0" x2="345" y2="54"/>
    <line x1="346" y1="0" x2="346" y2="54"/>
    <line x1="347" y1="0" x2="347" y2="54"/>
    <line x1="348" y1="0" x2="348" y2="54"/>
    <line x1="349" y1="0" x2="349" y2="54"/>
    <line x1="350" y1="0" x2="350" y2="54"/>
    <line x1="351" y1="0" x2="351" y2="54"/>
    <line x1="352" y1="0" x2="352" y2="54"/>
    <line x1="353" y1="0" x2="353" y2="54"/>
    <line x1="354" y1="0" x2="354" y2="54"/>
    <line x1="355" y1="0" x2="355" y2="54"/>
    <line x1="356" y1="0" x2="356" y2="54"/>
    <line x1="357" y1="0" x2="357" y2="54"/>
    <line x1="358" y1="0" x2="358" y2="54"/>
    <line x1="359" y1="0" x2="359" y2="54"/>
    <line x1="360" y1="0" x2="360" y2="54"/>
    <line x1="361" y1="0" x2="361" y2="54"/>
    <line x1="362" y1="0" x2="362" y2="54"/>
    <line x1="363" y1="0" x2="363" y2="54"/>
    <line x1="364" y1="0" x2="364" y2="54"/>
    <line x1="365" y1="0" x2="365" y2="54"/>
    <line x1="366" y1="0" x2="366" y2="54"/>
    <line x1="367" y1="0" x2="367" y2="54"/>
    <line x1="368" y1="0" x2="368" y2="54"/>
    <line x1="369" y1="0" x2="369" y2="54"/>
    <line x1="370" y1="0" x2="370" y2="54"/>
    <line x1="371" y1="0" x2="371" y2="54"/>
    <line x1="372" y1="0" x2="372" y2="54"/>
    <line x1="373" y1="0" x2="373" y2="54"/>
    <line x1="374" y1="0" x2="374" y2="54"/>
    <line x1="375" y1="0" x2="375" y2="54"/>
    <line x1="376" y1="0" x2="376" y2="54"/>
    <line x1="377" y1="0" x2="377" y2="54"/>
    <line x1="378" y1="0" x2="378" y2="54"/>
    <line x1="379" y1="0" x2="379" y2="54"/>
    <line x1="380" y1="0" x2="380" y2="54"/>
    <line x1="381" y1="0" x2="381" y2="54"/>
    <line x1="382" y1="0" x2="382" y2="54"/>
    <line x1="383" y1="0" x2="383" y2="54"/>
    <line x1="384" y1="0" x2="384" y2="54"/>
    <line x1="385" y1="0" x2="385" y2="54"/>
    <line x1="386" y1="0" x2="386" y2="54"/>
    <line x1="387" y1="0" x2="387" y2="54"/>
    <line x1="388" y1="0" x2="388" y2="54"/>
    <line x1="389" y1="0" x2="389" y2="54"/>
    <line x1="390" y1="0" x2="390" y2="54"/>
    <line x1="391" y1="0" x2="391" y2="54"/>
    <line x1="392" y1="0" x2="392" y2="54"/>
    <line x1="393" y1="0" x2="393" y2="54"/>
    <line x1="394" y1="0" x2="394" y2="54"/>
    <line x1="395" y1="0" x2="395" y2="54"/>
    <line x1="396" y1="0" x2="396" y2="54"/>
    <line x1="397" y1="0" x2="397" y2="54"/>
    <line x1="398" y1="0" x2="398" y2="54"/>
    <line x1="399" y1="0" x2="399" y2="54"/>
    <line x1="400" y1="0" x2="400" y2="54"/>
    <line x1="401" y1="0" x2="401" y2="54"/>
    <line x1="402" y1="0" x2="402" y2="54"/>
    <line x1="403" y1="0" x2="403" y2="54"/>
    <line x1="404" y1="0" x2="404" y2="54"/>
    <line x1="405" y1="0" x2="405" y2="54"/>
    <line x1="406" y1="0" x2="406" y2="54"/>
    <line x1="407" y1="0" x2="407" y2="54"/>
    <line x1="408" y1="0" x2="408" y2="54"/>
    <line x1="409" y1="0" x2="409" y2="54"/>
    <line x1="410" y1="0" x2="410" y2="54"/>
    <line x1="411" y1="0" x2="411" y2="54"/>
    <line x1="412" y1="0" x2="412" y2="54"/>
    <line x1="413" y1="0" x2="413" y2="54"/>
    <line x1="414" y1="0" x2="414" y2="54"/>
    <line x1="415" y1="0" x2="415" y2="54"/>
    <line x1="416" y1="0" x2="416" y2="54"/>
    <line x1="417" y1="0" x2="417" y2="54"/>
    <line x1="418" y1="0" x2="418" y2="54"/>
    <line x1="419" y1="0" x2="419" y2="54"/>
    <line x1="420" y1="0" x2="420" y2="54"/>
    <line x1="421" y1="0" x2="421" y2="54"/>
    <line x1="422" y1="0" x2="422" y2="54"/>
    <line x1="423" y1="0" x2="423" y2="54"/>
    <line x1="424" y1="0" x2="424" y2="54"/>
    <line x1="425" y1="0" x2="425" y2="54"/>
    <line x1="426" y1="0" x2="426" y2="54"/>
    <line x1="427" y1="0" x2="427" y2="54"/>
    <line x1="428" y1="0" x2="428" y2="54"/>
    <line x1="429" y1="0" x2="429" y2="54"/>
    <line x1="430" y1="0" x2="430" y2="54"/>
    <line x1="431" y1="0" x2="431" y2="54"/>
    <line x1="432" y1="0" x2="432" y2="54"/>
    <line x1="433" y1="0" x2="433" y2="54"/>
    <line x1="434" y1="0" x2="434" y2="54"/>
    <line x1="435" y1="0" x2="435" y2="54"/>
    <line x1="436" y1="0" x2="436" y2="54"/>
    <line x1="437" y1="0" x2="437" y2="54"/>
    <line x1="438" y1="0" x2="438" y2="54"/>
    <line x1="439" y1="0" x2="439" y2="54"/>
    <line x1="440" y1="0" x2="440" y2="54"/>
    <line x1="441" y1="0" x2="441" y2="54"/>
    <line x1="442" y1="0" x2="442" y2="54"/>
    <line x1="443" y1="0" x2="443" y2="54"/>
    <line x1="444" y1="0" x2="444" y2="54"/>
    <line x1="445" y1="0" x2="445" y2="54"/>
    <line x1="446" y1="0" x2="446" y2="54"/>
    <line x1="447" y1="0" x2="447" y2="54"/>
    <line x1="448" y1="0" x2="448" y2="54"/>
    <line x1="449" y1="0" x2="449" y2="54"/>
    <line x1="0" y1="1" x2="450" y2="1"/>
    <line x1="0" y1="2" x2="450" y2="2"/>
    <line x1="0" y1="3" x2="450" y2="3"/>
    <line x1="0" y1="4" x2="450" y2="4"/>
    <line x1="0" y1="5" x2="450" y2="5"/>
    <line x1="0" y1="6" x2="450" y2="6"/>
    <line x1="0" y1="7" x2="450" y2="7"/>
    <line x1="0" y1="8" x2="450" y2="8"/>
    <line x1="0" y1="9" x2="450" y2="9"/>
    <line x1="0" y1="10" x2="450" y2="10"/>
    <line x1="0" y1="11" x2="450" y2="11"/>
    <line x1="0" y1="12" x2="450" y2="12"/>
    <line x1="0" y1="13" x2="450" y2="13"/>
    <line x1="0" y1="14" x2="450" y2="14"/>
    <line x1="0" y1="15" x2="450" y2="15"/>
    <line x1="0" y1="16" x2="450" y2="16"/>
    <line x1="0" y1="17" x2="450" y2="17"/>
    <line x1="0" y1="18" x2="450" y2="18"/>
    <line x1="0" y1="19" x2="450" y2="19"/>
    <line x1="0" y1="20" x2="450" y2="20"/>
    <line x1="0" y1="21" x2="450" y2="21"/>
    <line x1="0" y1="22" x2="450" y2="22"/>
    <line x1="0" y1="23" x2="450" y2="23"/>
    <line x1="0" y1="24" x2="450" y2="24"/>
    <line x1="0" y1="25" x2="450" y2="25"/>
    <line x1="0" y1="26" x2="450" y2="26"/>
    <line x1="0" y1="27" x2="450" y2="27"/>
    <line x1="0" y1="28" x2="450" y2="28"/>
    <line x1="0" y1="29" x2="450" y2="29"/>
    <line x1="0" y1="30" x2="450" y2="30"/>
    <line x1="0" y1="31" x2="450" y2="31"/>
    <line x1="0" y1="32" x2="450" y2="32"/>
    <line x1="0" y1="33" x2="450" y2="33"/>
    <line x1="0" y1="34" x2="450" y2="34"/>
    <line x1="0" y1="35" x2="450" y2="35"/>
    <line x1="0" y1="36" x2="450" y2="36"/>
    <line x1="0" y1="37" x2="450" y2="37"/>
    <line x1="0" y1="38" x2="450" y2="38"/>
    <line x1="0" y1="39" x2="450" y2="39"/>
    <line x1="0" y1="40" x2="450" y2="40"/>
    <line x1="0" y1="41" x2="450" y2="41"/>
    <line x1="0" y1="42" x2="450" y2="42"/>
    <line x1="0" y1="43" x2="450" y2="43"/>
    <line x1="0" y1="44" x2="450" y2="44"/>
    <line x1="0" y1="45" x2="450" y2="45"/>
    <line x1="0" y1="46" x2="450" y2="46"/>
    <line x1="0" y1="47" x2="450" y2="47"/>
    <line x1="0" y1="48" x2="450" y2="48"/>
    <line x1="0" y1="49" x2="450" y2="49"/>
    <line x1="0" y1="50" x2="450" y2="50"/>
    <line x1="0" y1="51" x2="450" y2="51"/>
    <line x1="0" y1="52" x2="450" y2="52"/>
    <line x1="0" y1="53" x2="450" y2="53"/>
  </g>
  <g class="cell-grid">
    <line x1="9" y1="0" x2="9" y2="54"/>
    <line x1="18" y1="0" x2="18" y2="54"/>
    <line x1="27" y1="0" x2="27" y2="54"/>
    <line x1="36" y1="0" x2="36" y2="54"/>
    <line x1="45" y1="0" x2="45" y2="54"/>
    <line x1="54" y1="0" x2="54" y2="54"/>
    <line x1="63" y1="0" x2="63" y2="54"/>
    <line x1="72" y1="0" x2="72" y2="54"/>
    <line x1="81" y1="0" x2="81" y2="54"/>
    <line x1="90" y1="0" x2="90" y2="54"/>
    <line x1="99" y1="0" x2="99" y2="54"/>
    <line x1="108" y1="0" x2="108" y2="54"/>
    <line x1="117" y1="0" x2="117" y2="54"/>
    <line x1="126" y1="0" x2="126" y2="54"/>
    <line x1="135" y1="0" x2="135" y2="54"/>
    <line x1="144" y1="0" x2="144" y2="54"/>
    <line x1="153" y1="0" x2="153" y2="54"/>
    <line x1="162" y1="0" x2="162" y2="54"/>
    <line x1="171" y1="0" x2="171" y2="54"/>
    <line x1="180" y1="0" x2="180" y2="54"/>
    <line x1="189" y1="0" x2="189" y2="54"/>
    <line x1="198" y1="0" x2="198" y2="54"/>
    <line x1="207" y1="0" x2="207" y2="54"/>
    <line x1="216" y1="0" x2="216" y2="54"/>
    <line x1="225" y1="0" x2="225" y2="54"/>
    <line x1="234" y1="0" x2="234" y2="54"/>
    <line x1="243" y1="0" x2="243" y2="54"/>
    <line x1="252" y1="0" x2="252" y2="54"/>
    <line x1="261" y1="0" x2="261" y2="54"/>
    <line x1="270" y1="0" x2="270" y2="54"/>
    <line x1="279" y1="0" x2="279" y2="54"/>
    <line x1="288" y1="0" x2="288" y2="54"/>
    <line x1="297" y1="0" x2="297" y2="54"/>
    <line x1="306" y1="0" x2="306" y2="54"/>
    <line x1="315" y1="0" x2="315" y2="54"/>
    <line x1="324" y1="0" x2="324" y2="54"/>
    <line x1="333" y1="0" x2="333" y2="54"/>
    <line x1="342" y1="0" x2="342" y2="54"/>
    <line x1="351" y1="0" x2="351" y2="54"/>
    <line x1="360" y1="0" x2="360" y2="54"/>
    <line x1="369" y1="0" x2="369" y2="54"/>
    <line x1="378" y1="0" x2="378" y2="54"/>
    <line x1="387" y1="0" x2="387" y2="54"/>
    <line x1="396" y1="0" x2="396" y2="54"/>
    <line x1="405" y1="0" x2="405" y2="54"/>
    <line x1="414" y1="0" x2="414" y2="54"/>
    <line x1="423" y1="0" x2="423" y2="54"/>
    <line x1="432" y1="0" x2="432" y2="54"/>
    <line x1="441" y1="0" x2="441" y2="54"/>
    <line x1="0" y1="18" x2="450" y2="18"/>
    <line x1="0" y1="36" x2="450" y2="36"/>
  </g>
</svg>

      <div class="cell-highlight" id="cell-highlight"></div>
    </div>
  </div>
  <div class="tooltip" id="tooltip"></div>

  <script>
    // Check for minimal mode via query string
    const urlParams = new URLSearchParams(window.location.search);
    const isMinimalMode = urlParams.get('minimal') === 'true';
    if (isMinimalMode) {
      document.body.classList.add('minimal');
      // Apply theme from query params if provided
      const themeBg = urlParams.get('bg');
      const themeFg = urlParams.get('fg');
      if (themeBg) {
        document.body.style.background = themeBg;
      }
    }

    const BASE_CELL_WIDTH = 9;
    const BASE_CELL_HEIGHT = 18;
    const SVG_WIDTH = 450;
    const SVG_HEIGHT = 54;
    const COLS = 50;
    const ROWS = 3;
    const cellData = [
      [{"c":"日","fg":null,"bg":null,"a":0,"seq":1,"t":"2025-12-26T08:36:47.3965162+00:00","sixel":null,"link":null},{"c":"","fg":null,"bg":null,"a":0,"seq":1,"t":"2025-12-26T08:36:47.3965162+00:00","sixel":null,"link":null},{"c":"本","fg":null,"bg":null,"a":0,"seq":2,"t":"2025-12-26T08:36:47.3965168+00:00","sixel":null,"link":null},{"c":"","fg":null,"bg":null,"a":0,"seq":2,"t":"2025-12-26T08:36:47.3965168+00:00","sixel":null,"link":null},{"c":"語","fg":null,"bg":null,"a":0,"seq":3,"t":"2025-12-26T08:36:47.3965172+00:00","sixel":null,"link":null},{"c":"","fg":null,"bg":null,"a":0,"seq":3,"t":"2025-12-26T08:36:47.3965172+00:00","sixel":null,"link":null},{"c":"テ","fg":null,"bg":null,"a":0,"seq":4,"t":"2025-12-26T08:36:47.3965176+00:00","sixel":null,"link":null},{"c":"","fg":null,"bg":null,"a":0,"seq":4,"t":"2025-12-26T08:36:47.3965176+00:00","sixel":null,"link":null},{"c":"ス","fg":null,"bg":null,"a":0,"seq":5,"t":"2025-12-26T08:36:47.3965177+00:00","sixel":null,"link":null},{"c":"","fg":null,"bg":null,"a":0,"seq":5,"t":"2025-12-26T08:36:47.3965177+00:00","sixel":null,"link":null},{"c":"ト","fg":null,"bg":null,"a":0,"seq":6,"t":"2025-12-26T08:36:47.3965180+00:00","sixel":null,"link":null},{"c":"","fg":null,"bg":null,"a":0,"seq":6,"t":"2025-12-26T08:36:47.3965180+00:00","sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":7,"t":"2025-12-26T08:36:47.3965187+00:00","sixel":null,"link":null},{"c":"🎉","fg":null,"bg":null,"a":0,"seq":8,"t":"2025-12-26T08:36:47.3965387+00:00","sixel":null,"link":null},{"c":"","fg":null,"bg":null,"a":0,"seq":8,"t":"2025-12-26T08:36:47.3965387+00:00","sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null}],
      [{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null}],
      [{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null},{"c":" ","fg":null,"bg":null,"a":0,"seq":0,"t":null,"sixel":null,"link":null}]
    ];

    const container = document.getElementById('svg-container');
    const highlight = document.getElementById('cell-highlight');
    const tooltip = document.getElementById('tooltip');
    const svg = container.querySelector('svg');

    // Track current cell for shimmer effect
    let currentCellX = -1;
    let currentCellY = -1;

    // Track pinned state for tooltip
    let isPinned = false;
    let pinnedCellX = -1;
    let pinnedCellY = -1;

    // Track highlighted cell groups
    let highlightedGroups = new Set();

    // Scale SVG to fill container while maintaining aspect ratio
    function updateSvgScale() {
      const containerRect = container.getBoundingClientRect();
      const padding = 40; // 20px padding on each side
      const availableWidth = containerRect.width - padding;
      const availableHeight = containerRect.height - padding;
      const scaleX = availableWidth / SVG_WIDTH;
      const scaleY = availableHeight / SVG_HEIGHT;
      const scale = Math.min(scaleX, scaleY);
      svg.style.width = (SVG_WIDTH * scale) + 'px';
      svg.style.height = (SVG_HEIGHT * scale) + 'px';
    }
    updateSvgScale();
    window.addEventListener('resize', updateSvgScale);

    function rgbToHex(r, g, b) {
      return '#' + [r, g, b].map(x => x.toString(16).padStart(2, '0')).join('');
    }

    function rgbToHsl(r, g, b) {
      r /= 255; g /= 255; b /= 255;
      const max = Math.max(r, g, b), min = Math.min(r, g, b);
      let h, s, l = (max + min) / 2;
      if (max === min) { h = s = 0; }
      else {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch (max) {
          case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
          case g: h = ((b - r) / d + 2) / 6; break;
          case b: h = ((r - g) / d + 4) / 6; break;
        }
      }
      return `hsl(${Math.round(h * 360)}, ${Math.round(s * 100)}%, ${Math.round(l * 100)}%)`;
    }

    function getAttributeBadges(attrs) {
      const badges = [];
      if (attrs & 1) badges.push('<span class="attr-badge bold">Bold</span>');
      if (attrs & 2) badges.push('<span class="attr-badge dim">Dim</span>');
      if (attrs & 4) badges.push('<span class="attr-badge italic">Italic</span>');
      if (attrs & 8) badges.push('<span class="attr-badge underline">Underline</span>');
      if (attrs & 16) badges.push('<span class="attr-badge blink">Blink</span>');
      if (attrs & 32) badges.push('<span class="attr-badge reverse">Reverse</span>');
      if (attrs & 64) badges.push('<span class="attr-badge hidden">Hidden</span>');
      if (attrs & 128) badges.push('<span class="attr-badge strikethrough">Strike</span>');
      if (attrs & 256) badges.push('<span class="attr-badge overline">Overline</span>');
      return badges.length > 0 ? badges.join('') : '<span style="color:#666">None</span>';
    }

    function formatColorInfo(color, label) {
      if (!color) return `<span style="color:#666">Default</span>`;
      const hex = rgbToHex(color.r, color.g, color.b);
      const hsl = rgbToHsl(color.r, color.g, color.b);
      return `<span class="color-swatch" style="background:${hex}"></span>${hex}<br>` +
             `<span style="color:#888;font-size:11px">rgb(${color.r}, ${color.g}, ${color.b})<br>${hsl}</span>`;
    }

    function renderTooltip(cell, x, y) {
      const char = cell.c === ' ' ? '␣' : (cell.c === '\0' ? '∅' : (cell.c === '' ? '⋯' : cell.c));
      const codePoint = cell.c.codePointAt(0) || 0;
      const fgStyle = cell.fg ? `color:rgb(${cell.fg.r},${cell.fg.g},${cell.fg.b});` : '';
      const bgStyle = cell.bg ? `background:rgb(${cell.bg.r},${cell.bg.g},${cell.bg.b});` : 'background:#1e1e1e;';
      const seqInfo = cell.seq ? `Seq: ${cell.seq}` : 'Seq: 0';
      const timeInfo = cell.t ? new Date(cell.t).toLocaleTimeString() : '-';
      const hasSixel = cell.sixel;
      const hasLink = cell.link;

      return `
        <div class="tooltip-header">
          <div class="tooltip-char" style="${fgStyle}${bgStyle}">${char}</div>
          <div>
            <div style="font-size:16px;font-weight:500">Cell (${x}, ${y})</div>
            <div class="tooltip-position">Column ${x}, Row ${y}</div>
          </div>
        </div>
        <div class="tooltip-section">
          <div class="tooltip-label">Character</div>
          <div class="tooltip-value">
            '${cell.c === '\0' ? '\\0 (null)' : (cell.c === '' ? '(continuation)' : cell.c)}' &nbsp;|&nbsp; 
            U+${codePoint.toString(16).toUpperCase().padStart(4, '0')} &nbsp;|&nbsp; 
            Dec: ${codePoint}
          </div>
        </div>
        <div class="tooltip-row">
          <div class="tooltip-section">
            <div class="tooltip-label">Foreground</div>
            <div class="tooltip-value">${formatColorInfo(cell.fg, 'fg')}</div>
          </div>
          <div class="tooltip-section">
            <div class="tooltip-label">Background</div>
            <div class="tooltip-value">${formatColorInfo(cell.bg, 'bg')}</div>
          </div>
        </div>
        <div class="tooltip-section">
          <div class="tooltip-label">Attributes (${cell.a})</div>
          <div class="tooltip-value">${getAttributeBadges(cell.a)}</div>
        </div>
        <div class="tooltip-section">
          <div class="tooltip-label">Write Order</div>
          <div class="tooltip-value">${seqInfo} &nbsp;|&nbsp; ${timeInfo}</div>
        </div>
        ${hasSixel ? `
        <div class="tooltip-section">
          <div class="tooltip-label">Sixel Graphics</div>
          <div class="tooltip-value">
            ${cell.sixel.origin ? '<span class="attr-badge" style="background:#4e9a06">Origin</span>' : '<span class="attr-badge">Continuation</span>'}
            ${cell.sixel.w}×${cell.sixel.h} cells
          </div>
        </div>` : ''}
        ${hasLink ? `
        <div class="tooltip-section">
          <div class="tooltip-label">Hyperlink (OSC 8)</div>
          <div class="tooltip-value">
            <a href="${cell.link.uri}" target="_blank" style="color:#00d4ff;text-decoration:underline;word-break:break-all">${cell.link.uri}</a>
            ${cell.link.params ? `<br><span style="color:#888;font-size:11px">Params: ${cell.link.params}</span>` : ''}
            ${cell.link.group ? `<br><button class="highlight-toggle ${highlightedGroups.has(cell.link.group) ? 'active' : ''}" onclick="toggleGroupHighlight('${cell.link.group}')">👁 ${highlightedGroups.has(cell.link.group) ? 'Hide' : 'Show'} related cells</button>` : ''}
          </div>
        </div>` : ''}
        ${isPinned ? `<span class="tooltip-pin-indicator" onclick="unpinTooltip()" title="Click to unpin">📌</span>` : ''}
      `;
    }

    // Toggle highlight for a cell group (e.g., all cells with same hyperlink)
    function toggleGroupHighlight(groupName) {
      if (highlightedGroups.has(groupName)) {
        highlightedGroups.delete(groupName);
        // Remove highlight class from all cells in this group
        svg.querySelectorAll(`g.cell.${groupName}`).forEach(g => g.classList.remove('highlight'));
      } else {
        highlightedGroups.add(groupName);
        // Add highlight class to all cells in this group
        svg.querySelectorAll(`g.cell.${groupName}`).forEach(g => g.classList.add('highlight'));
      }
      // Re-render tooltip to update button state
      if (isPinned) {
        const cell = cellData[pinnedCellY][pinnedCellX];
        tooltip.innerHTML = renderTooltip(cell, pinnedCellX, pinnedCellY);
      }
    }
    // Make function available globally for onclick
    window.toggleGroupHighlight = toggleGroupHighlight;

    // Pin the tooltip in place
    function pinTooltip(x, y) {
      isPinned = true;
      pinnedCellX = x;
      pinnedCellY = y;
      tooltip.classList.add('pinned');
      // Re-render to show pin indicator
      const cell = cellData[y][x];
      tooltip.innerHTML = renderTooltip(cell, x, y);
    }

    // Unpin the tooltip
    function unpinTooltip() {
      isPinned = false;
      pinnedCellX = -1;
      pinnedCellY = -1;
      tooltip.classList.remove('pinned');
      tooltip.classList.remove('visible');
      highlight.classList.remove('visible');
    }
    // Make function available globally for onclick
    window.unpinTooltip = unpinTooltip;

    container.addEventListener('mousemove', (e) => {
      // If tooltip is pinned, don't update on hover
      if (isPinned) return;

      const svgRect = svg.getBoundingClientRect();
      const scaleX = svgRect.width / SVG_WIDTH;
      const scaleY = svgRect.height / SVG_HEIGHT;
      const cellWidth = BASE_CELL_WIDTH * scaleX;
      const cellHeight = BASE_CELL_HEIGHT * scaleY;
      const x = Math.floor((e.clientX - svgRect.left) / cellWidth);
      const y = Math.floor((e.clientY - svgRect.top) / cellHeight);

      if (x >= 0 && x < COLS && y >= 0 && y < ROWS) {
        const cell = cellData[y][x];

        // Check if we moved to a new cell
        const cellChanged = (x !== currentCellX || y !== currentCellY);
        currentCellX = x;
        currentCellY = y;

        // Position highlight relative to SVG
        const svgOffset = svg.getBoundingClientRect();
        const containerOffset = container.getBoundingClientRect();
        highlight.style.left = (svgOffset.left - containerOffset.left + x * cellWidth) + 'px';
        highlight.style.top = (svgOffset.top - containerOffset.top + y * cellHeight) + 'px';
        highlight.style.width = cellWidth + 'px';
        highlight.style.height = cellHeight + 'px';
        highlight.classList.add('visible');

        // Shimmer effect when moving to a new cell
        if (cellChanged) {
          highlight.classList.add('shimmer');
          setTimeout(() => highlight.classList.remove('shimmer'), 200);
        }

        // Update and position tooltip
        tooltip.innerHTML = renderTooltip(cell, x, y);
        tooltip.classList.add('visible');

        // Position tooltip to avoid viewport edges
        let tooltipX = e.clientX + 15;
        let tooltipY = e.clientY + 15;
        const tooltipRect = tooltip.getBoundingClientRect();
        if (tooltipX + tooltipRect.width > window.innerWidth - 10) {
          tooltipX = e.clientX - tooltipRect.width - 15;
        }
        if (tooltipY + tooltipRect.height > window.innerHeight - 10) {
          tooltipY = e.clientY - tooltipRect.height - 15;
        }
        tooltip.style.left = tooltipX + 'px';
        tooltip.style.top = tooltipY + 'px';
      } else {
        highlight.classList.remove('visible');
        tooltip.classList.remove('visible');
        currentCellX = -1;
        currentCellY = -1;
      }
    });

    // Click to pin tooltip
    container.addEventListener('click', (e) => {
      const svgRect = svg.getBoundingClientRect();
      const scaleX = svgRect.width / SVG_WIDTH;
      const scaleY = svgRect.height / SVG_HEIGHT;
      const cellWidth = BASE_CELL_WIDTH * scaleX;
      const cellHeight = BASE_CELL_HEIGHT * scaleY;
      const x = Math.floor((e.clientX - svgRect.left) / cellWidth);
      const y = Math.floor((e.clientY - svgRect.top) / cellHeight);

      if (x >= 0 && x < COLS && y >= 0 && y < ROWS) {
        if (isPinned && pinnedCellX === x && pinnedCellY === y) {
          // Clicking pinned cell again unpins
          unpinTooltip();
        } else {
          // Pin to this cell
          pinTooltip(x, y);
        }
      }
    });

    container.addEventListener('mouseleave', () => {
      // Only hide if not pinned
      if (!isPinned) {
        highlight.classList.remove('visible');
        tooltip.classList.remove('visible');
      }
    });

    // Theme controls
    const bgPicker = document.getElementById('bg-picker');
    const fgPicker = document.getElementById('fg-picker');
    const btnDark = document.getElementById('btn-dark');
    const btnLight = document.getElementById('btn-light');
    const cellGridToggle = document.getElementById('cell-grid-toggle');
    const pixelGridToggle = document.getElementById('pixel-grid-toggle');
    const cellGridColorPicker = document.getElementById('cell-grid-color');
    const pixelGridColorPicker = document.getElementById('pixel-grid-color');

    let currentDefaultBg = '#1e1e1e';
    let currentDefaultFg = '#d4d4d4';
    let cellGridCustomColor = false;
    let pixelGridCustomColor = false;

    // Compute contrasting color for grids based on background luminance
    function getContrastingGridColor(bgColor, alpha) {
      const hex = bgColor.replace('#', '');
      const r = parseInt(hex.substr(0, 2), 16);
      const g = parseInt(hex.substr(2, 2), 16);
      const b = parseInt(hex.substr(4, 2), 16);
      const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
      const base = luminance > 0.5 ? 0 : 255;
      const adjusted = Math.round(base * alpha + (luminance > 0.5 ? 255 : 0) * (1 - alpha));
      const hex2 = adjusted.toString(16).padStart(2, '0');
      return `#${hex2}${hex2}${hex2}`;
    }

    function updateGridColors(bgColor) {
      if (!cellGridCustomColor) {
        const cellColor = getContrastingGridColor(bgColor, 0.5);
        cellGridColorPicker.value = cellColor;
        svg.querySelectorAll('.cell-grid line').forEach(el => el.setAttribute('stroke', cellColor));
      }
      if (!pixelGridCustomColor) {
        const pixelColor = getContrastingGridColor(bgColor, 0.25);
        pixelGridColorPicker.value = pixelColor;
        svg.querySelectorAll('.pixel-grid line').forEach(el => el.setAttribute('stroke', pixelColor));
      }
    }

    function updateTheme(newBg, newFg) {
      // Update the main background rect (first rect in SVG)
      const bgRect = svg.querySelector('rect');
      if (bgRect) bgRect.setAttribute('fill', newBg);

      // Update all cell background rects that use default background
      const allRects = svg.querySelectorAll('g.terminal-text rect');
      allRects.forEach(rect => {
        const currentFill = rect.getAttribute('fill');
        if (currentFill === currentDefaultBg) {
          rect.setAttribute('fill', newBg);
        }
      });

      // Update text elements using default foreground
      const allText = svg.querySelectorAll('g.terminal-text text');
      allText.forEach(text => {
        const currentFill = text.getAttribute('fill');
        if (currentFill === currentDefaultFg) {
          text.setAttribute('fill', newFg);
        }
      });

      currentDefaultBg = newBg;
      currentDefaultFg = newFg;
      bgPicker.value = newBg;
      fgPicker.value = newFg;

      // Update grid colors based on new background
      updateGridColors(newBg);
    }

    bgPicker.addEventListener('input', (e) => {
      updateTheme(e.target.value, currentDefaultFg);
      btnDark.classList.remove('active');
      btnLight.classList.remove('active');
    });

    fgPicker.addEventListener('input', (e) => {
      updateTheme(currentDefaultBg, e.target.value);
      btnDark.classList.remove('active');
      btnLight.classList.remove('active');
    });

    btnDark.addEventListener('click', () => {
      updateTheme('#1e1e1e', '#d4d4d4');
      btnDark.classList.add('active');
      btnLight.classList.remove('active');
    });

    btnLight.addEventListener('click', () => {
      updateTheme('#ffffff', '#1e1e1e');
      btnLight.classList.add('active');
      btnDark.classList.remove('active');
    });

    // Grid toggle and color controls
    cellGridToggle.addEventListener('change', (e) => {
      container.classList.toggle('show-cell-grid', e.target.checked);
    });

    pixelGridToggle.addEventListener('change', (e) => {
      container.classList.toggle('show-pixel-grid', e.target.checked);
    });

    cellGridColorPicker.addEventListener('input', (e) => {
      cellGridCustomColor = true;
      svg.querySelectorAll('.cell-grid line').forEach(el => el.setAttribute('stroke', e.target.value));
    });

    pixelGridColorPicker.addEventListener('input', (e) => {
      pixelGridCustomColor = true;
      svg.querySelectorAll('.pixel-grid line').forEach(el => el.setAttribute('stroke', e.target.value));
    });

    // Initialize grid colors based on default background
    updateGridColors(currentDefaultBg);
  </script>
</body>
</html>
